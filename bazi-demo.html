<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字命理分析系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .input-section {
            padding: 40px;
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            padding: 40px;
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .result-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #667eea;
        }

        .result-card h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-card h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #667eea;
            border-radius: 2px;
        }

        .si-zhu-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .pillar {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .pillar:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .pillar-title {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .pillar-ganzhi {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .pillar-nayin {
            color: #718096;
            font-size: 0.9rem;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-item {
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 3px solid #4299e1;
        }

        .info-item h3 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .info-item p {
            color: #4a5568;
            line-height: 1.6;
        }

        .strength-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .strength-bar {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            transition: width 1s ease;
        }

        .ten-gods-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .ten-god-item {
            background: #edf2f7;
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
            min-width: 120px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .ten-god-item:hover {
            border-color: #667eea;
            background: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .ten-god-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .ten-god-count {
            color: #718096;
            font-size: 0.9rem;
        }

        .pattern-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin: 5px;
        }

        .dayun-timeline {
            margin-top: 20px;
        }

        .dayun-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #4299e1;
        }

        .dayun-age {
            font-weight: 600;
            color: #2d3748;
            min-width: 100px;
        }

        .dayun-ganzhi {
            font-size: 1.2rem;
            color: #4a5568;
            margin: 0 20px;
        }

        .dayun-quality {
            margin-left: auto;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .quality-high {
            background: #c6f6d5;
            color: #22543d;
        }

        .quality-medium {
            background: #feebc8;
            color: #744210;
        }

        .quality-low {
            background: #fed7d7;
            color: #742a2a;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #4a5568;
        }

        .loading-spinner {
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fed7d7;
            color: #742a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #e53e3e;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #38a169;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .si-zhu-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .results-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>八字命理分析系统</h1>
            <p>传统命理智慧与现代科技的完美结合</p>
            <div style="margin-top: 15px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                <span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 0.9rem;">基础分析</span>
                <span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 0.9rem;">格局精通</span>
                <span style="background: rgba(102,126,234,0.8); padding: 5px 10px; border-radius: 15px; font-size: 0.9rem; font-weight: bold;">实战技法</span>
            </div>
        </header>

        <section class="input-section">
            <form id="baziForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name">姓名</label>
                        <input type="text" id="name" name="name" placeholder="请输入您的姓名">
                    </div>
                    <div class="form-group">
                        <label for="gender">性别</label>
                        <select id="gender" name="gender" required>
                            <option value="">请选择性别</option>
                            <option value="男">男</option>
                            <option value="女">女</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="birthDate">出生日期</label>
                        <input type="date" id="birthDate" name="birthDate" required>
                    </div>
                    <div class="form-group">
                        <label for="birthTime">出生时间</label>
                        <input type="time" id="birthTime" name="birthTime" required>
                    </div>
                </div>

                <!-- 第四阶段实战技法选项 -->
                <div style="margin-top: 30px; padding: 20px; background: #f0f4f8; border-radius: 8px; border-left: 4px solid #667eea;">
                    <h3 style="margin-bottom: 15px; color: #2d3748;">🎯 第四阶段实战技法选项</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="analysisType">分析类型</label>
                            <select id="analysisType" name="analysisType">
                                <option value="basic">基础分析</option>
                                <option value="pattern">格局精通</option>
                                <option value="practical" selected>实战技法</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="liuNian">流年分析（可选）</label>
                            <input type="text" id="liuNian" name="liuNian" placeholder="如：甲辰 2024">
                        </div>
                    </div>

                    <!-- 实战技法方法选择 -->
                    <div style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px; color: #4a5568;">选择实战技法方法：</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <label style="display: flex; align-items: center; gap: 5px; background: white; padding: 8px; border-radius: 5px; border: 1px solid #e2e8f0;">
                                <input type="checkbox" name="methods" value="xiangfa" checked>
                                <span style="font-size: 0.9rem;">探索门取象法</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: white; padding: 8px; border-radius: 5px; border: 1px solid #e2e8f0;">
                                <input type="checkbox" name="methods" value="jinglun" checked>
                                <span style="font-size: 0.9rem;">命理精论</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: white; padding: 8px; border-radius: 5px; border: 1px solid #e2e8f0;">
                                <input type="checkbox" name="methods" value="qicai" checked>
                                <span style="font-size: 0.9rem;">妻财专项分析</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: white; padding: 8px; border-radius: 5px; border: 1px solid #e2e8f0;">
                                <input type="checkbox" name="methods" value="liunian" checked>
                                <span style="font-size: 0.9rem;">流年实务</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: white; padding: 8px; border-radius: 5px; border: 1px solid #e2e8f0;">
                                <input type="checkbox" name="methods" value="anli" checked>
                                <span style="font-size: 0.9rem;">案例验证</span>
                            </label>
                        </div>
                    </div>
                </div>
                <button type="submit" class="calculate-btn" id="calculateBtn">
                    开始八字分析
                </button>
            </form>
        </section>

        <section class="results-section" id="resultsSection">
            <div id="loadingIndicator" class="loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p>正在分析您的八字命理，请稍候...</p>
            </div>

            <div id="resultsContent"></div>
        </section>
    </div>

    <script>
        // 注意：这里是前端演示代码，实际的八字计算需要在后端Node.js环境中运行
        // 这里模拟了整个分析流程，展示用户界面和交互

        class BaziWebFrontend {
            constructor() {
                this.form = document.getElementById('baziForm');
                this.calculateBtn = document.getElementById('calculateBtn');
                this.resultsSection = document.getElementById('resultsSection');
                this.loadingIndicator = document.getElementById('loadingIndicator');
                this.resultsContent = document.getElementById('resultsContent');

                this.initEventListeners();
            }

            initEventListeners() {
                this.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleCalculate();
                });
            }

            async handleCalculate() {
                const formData = new FormData(this.form);
                const inputData = {
                    name: formData.get('name'),
                    gender: formData.get('gender'),
                    birthDate: formData.get('birthDate'),
                    birthTime: formData.get('birthTime'),
                    analysisType: formData.get('analysisType'),
                    liuNian: formData.get('liuNian'),
                    methods: this.getSelectedMethods()
                };

                // 验证输入
                if (!this.validateInput(inputData)) {
                    return;
                }

                // 显示加载状态
                this.showLoading();

                try {
                    // 根据分析类型调用不同的计算方法
                    let result;
                    if (inputData.analysisType === 'practical') {
                        result = await this.mockPracticalAnalysis(inputData);
                    } else if (inputData.analysisType === 'pattern') {
                        result = await this.mockPatternAnalysis(inputData);
                    } else {
                        result = await this.mockBaziCalculation(inputData);
                    }

                    this.displayResults(result);
                } catch (error) {
                    this.showError('计算失败：' + error.message);
                } finally {
                    this.hideLoading();
                }
            }

            getSelectedMethods() {
                const checkboxes = document.querySelectorAll('input[name="methods"]:checked');
                return Array.from(checkboxes).map(cb => cb.value);
            }

            validateInput(inputData) {
                if (!inputData.gender) {
                    this.showError('请选择性别');
                    return false;
                }
                if (!inputData.birthDate) {
                    this.showError('请选择出生日期');
                    return false;
                }
                if (!inputData.birthTime) {
                    this.showError('请选择出生时间');
                    return false;
                }
                return true;
            }

            showLoading() {
                this.loadingIndicator.style.display = 'block';
                this.calculateBtn.disabled = true;
                this.calculateBtn.textContent = '分析中...';
            }

            hideLoading() {
                this.loadingIndicator.style.display = 'none';
                this.calculateBtn.disabled = false;
                this.calculateBtn.textContent = '开始八字分析';
            }

            showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = message;
                this.form.appendChild(errorDiv);
                setTimeout(() => errorDiv.remove(), 5000);
            }

            showSuccess(message) {
                const successDiv = document.createElement('div');
                successDiv.className = 'success-message';
                successDiv.textContent = message;
                this.form.appendChild(successDiv);
                setTimeout(() => successDiv.remove(), 5000);
            }

            // 模拟实战技法分析
            async mockPracticalAnalysis(inputData) {
                await new Promise(resolve => setTimeout(resolve, 3000));

                const birthDateTime = `${inputData.birthDate} ${inputData.birthTime}`;
                const methods = inputData.methods;

                const results = {
                    basicInfo: {
                        name: inputData.name || '用户',
                        gender: inputData.gender,
                        birthDate: new Date(inputData.birthDate).toLocaleDateString('zh-CN'),
                        birthTime: inputData.birthTime,
                        analysisType: '实战技法深度分析',
                        methods: methods.map(m => this.getMethodName(m))
                    }
                };

                // 根据选择的方法生成对应的分析结果
                if (methods.includes('xiangfa')) {
                    results.xiangfaAnalysis = {
                        title: '探索门取象法分析',
                        images: [
                            { element: '甲木', image: '参天大树、栋梁之材', interpretation: '性格正直向上，有责任担当，适合做领导工作' },
                            { element: '午火', image: '烈日当空、光明温暖', interpretation: '热情开朗，乐于助人，有社会影响力' },
                            { element: '戌土', image: '高山厚土、包容万物', interpretation: '稳重踏实，包容性强，能承担重任' },
                            { element: '子水', image: '江河湖海、智慧流动', interpretation: '聪明灵活，适应性强，有商业头脑' }
                        ],
                        synthesis: '综合取象：此命为栋梁之材配光明温暖之象，又有厚重基础承载，是典型的成功人士之象，适合在社会上发挥重要作用。',
                        applications: ['职业发展：适合管理、教育、公益事业', '人生定位：应以服务社会、实现价值为目标', '发展策略：稳扎稳打，以德服人']
                    };
                }

                if (methods.includes('jinglun')) {
                    results.jinglunAnalysis = {
                        title: '命理精论深度分析',
                        corePrinciples: [
                            { principle: '阴阳协调', analysis: '命局中阴阳搭配较为和谐，刚柔相济，能适应各种环境' },
                            { principle: '五行流通', analysis: '五行生克路径清晰，气势流通，人生发展相对顺畅' },
                            { principle: '用神得力', analysis: '用神火土相生，在命局中有根有力，能发挥积极作用' }
                        ],
                        lifePattern: {
                            pattern: '木火通明格',
                            characteristics: ['聪明好学', '温文尔雅', '有创造力', '适合文化事业'],
                            development: '青年时期努力学习积累知识，中年时期发挥才能获得成就，晚年享受文化成果'
                        },
                        wisdom: ['知命而为，顺势而为', '以德修身，以才立业', '平衡发展，不可偏废']
                    };
                }

                if (methods.includes('qicai')) {
                    results.qicaiAnalysis = {
                        title: '妻财专项分析',
                        marriageAnalysis: {
                            spousePalace: '日支戌土',
                            spouseCharacter: '稳重踏实、有责任感、顾家',
                            marriageQuality: '配偶宫为土，日主木克土为财，感情基础较好',
                            marriageTiming: '25-30岁为最佳婚期，配偶多在东方或南方相遇',
                            marriageAdvice: ['选择对象要重德重才', '婚姻需要经营和维护', '家庭和睦是事业的基础']
                        },
                        wealthAnalysis: {
                            wealthElement: '土为正财',
                            wealthQuality: '财星有根，财运稳定',
                            wealthPath: '通过专业技能和服务获得收入',
                            wealthTiming: '35岁后财运渐佳，中晚年财富丰厚',
                            wealthAdvice: ['技能立身是根本', '稳健投资不冒进', '散财积德福报长']
                        }
                    };
                }

                if (methods.includes('liunian')) {
                    const currentYear = new Date().getFullYear();
                    results.liunianAnalysis = {
                        title: '流年实务分析',
                        currentYear: {
                            year: currentYear,
                            ganzhi: this.getYearGanzhi(currentYear),
                            analysis: '流年与命局形成较好配合，事业发展机遇较多',
                            opportunities: ['事业提升机会', '人际关系改善', '学习进修良机'],
                            challenges: ['注意健康问题', '防范财务风险', '避免冲动决策'],
                            monthlyFocus: [
                                { month: '1-3月', focus: '规划布局，奠定基础' },
                                { month: '4-6月', focus: '积极行动，把握机遇' },
                                { month: '7-9月', focus: '稳扎稳打，巩固成果' },
                                { month: '10-12月', focus: '总结反思，准备来年' }
                            ]
                        }
                    };
                }

                if (methods.includes('anli')) {
                    results.anliAnalysis = {
                        title: '案例验证分析',
                        similarCases: [
                            {
                                case: '历史名人A',
                                bazi: '甲午 丙戌 甲戌 子时',
                                similarity: '格局相似度为85%',
                                outcome: '中年成名，一生富贵',
                                enlightenment: '此命格历史上多出文武全才之人物'
                            },
                            {
                                case: '现代成功人士B',
                                bazi: '甲寅 丁卯 甲子 丑时',
                                similarity: '五行配置相似度为78%',
                                outcome: '企业家，社会知名人士',
                                enlightenment: '现代适合在商业或专业领域发展'
                            }
                        ],
                        validation: '经过历史案例和现代实例验证，此命格具有明显的成功倾向，只要把握时机，努力奋斗，必有所成。',
                        confidence: '综合验证置信度：82%'
                    };
                }

                // 综合建议
                results.comprehensiveAdvice = {
                    summary: '综合各项实战技法分析，此命格为上等命局，具有成功人士的各项特征。',
                    strengths: ['天赋较好', '机遇较多', '性格完善', '运势顺畅'],
                    focus: ['发挥领导才能', '注重知识积累', '把握时机行动', '维护家庭和谐'],
                    caution: ['不可骄傲自满', '注意身体健康', '防范人际风险', '持续学习提升']
                };

                return results;
            }

            // 获取方法名称
            getMethodName(method) {
                const names = {
                    'xiangfa': '探索门取象法',
                    'jinglun': '命理精论',
                    'qicai': '妻财专项分析',
                    'liunian': '流年实务',
                    'anli': '案例验证'
                };
                return names[method] || method;
            }

            // 获取年份干支
            getYearGanzhi(year) {
                const ganzhi = ['甲子', '乙丑', '丙寅', '丁卯', '戊辰', '己巳', '庚午', '辛未', '壬申', '癸酉',
                               '甲戌', '乙亥', '丙子', '丁丑', '戊寅', '己卯', '庚辰', '辛巳', '壬午', '癸未',
                               '甲申', '乙酉', '丙戌', '丁亥', '戊子', '己丑', '庚寅', '辛卯', '壬辰', '癸巳',
                               '甲午', '乙未', '丙申', '丁酉', '戊戌', '己亥', '庚子', '辛丑', '壬寅', '癸卯',
                               '甲辰', '乙巳', '丙午', '丁未', '戊申', '己酉', '庚戌', '辛亥', '壬子', '癸丑',
                               '甲寅', '乙卯', '丙辰', '丁巳', '戊午', '己未', '庚申', '辛酉', '壬戌', '癸亥'];
                return ganzhi[(year - 4) % 60];
            }

            // 模拟格局精通分析
            async mockPatternAnalysis(inputData) {
                await new Promise(resolve => setTimeout(resolve, 2500));

                return {
                    basicInfo: {
                        name: inputData.name || '用户',
                        gender: inputData.gender,
                        birthDate: new Date(inputData.birthDate).toLocaleDateString('zh-CN'),
                        birthTime: inputData.birthTime,
                        analysisType: '格局精通分析'
                    },
                    patternAnalysis: {
                        mainPattern: {
                            name: '正官格',
                            category: '正格',
                            quality: '上等格局',
                            purity: '纯净度85%',
                            feeling: '有情度90%',
                            strength: '有力度75%',
                            balance: '平衡度80%',
                            description: '正官清纯，有情有力，是典型的贵格，主事业成功，社会地位高'
                        },
                        professionalAssessment: {
                            overall: '上等格局',
                            characteristics: ['官印相生', '清正廉洁', '有领导才能', '社会认可度高'],
                            careerAdvice: ['适合公务员', '企业管理', '专业技术人员', '教育工作者'],
                            developmentStage: '30岁后开始展现才能，中年达到事业高峰'
                        }
                    },
                    comprehensiveAdvice: {
                        summary: '格局清正，前程远大',
                        focus: ['发挥管理才能', '注重品德修养', '稳扎稳打发展'],
                        caution: ['避免急功近利', '注意人际关系']
                    }
                };
            }

            displayResults(result) {
                this.resultsSection.classList.add('active');

                let html = `
                    <!-- 基本信息 -->
                    <div class="result-card">
                        <h2>基本信息</h2>
                        <div class="info-grid">
                            <div class="info-item">
                                <h3>姓名</h3>
                                <p>${result.basicInfo.name}</p>
                            </div>
                            <div class="info-item">
                                <h3>性别</h3>
                                <p>${result.basicInfo.gender}</p>
                            </div>
                            <div class="info-item">
                                <h3>出生时间</h3>
                                <p>${result.basicInfo.birthDate} ${result.basicInfo.birthTime}</p>
                            </div>
                            <div class="info-item">
                                <h3>分析类型</h3>
                                <p>${result.basicInfo.analysisType || '基础八字分析'}</p>
                            </div>
                        </div>
                        ${result.basicInfo.methods ? `
                            <div class="info-item" style="margin-top: 15px;">
                                <h3>分析方法</h3>
                                <p>${result.basicInfo.methods.join('、')}</p>
                            </div>
                        ` : ''}
                    </div>
                `;

                // 实战技法分析结果
                if (result.xiangfaAnalysis) {
                    html += `
                        <div class="result-card">
                            <h2>${result.xiangfaAnalysis.title}</h2>
                            <h3 style="color: #4a5568; margin: 20px 0 15px 0; font-size: 1.2rem;">核心意象解析</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                                ${result.xiangfaAnalysis.images.map(img => `
                                    <div class="info-item" style="border-left: 4px solid #667eea;">
                                        <h4>${img.element}</h4>
                                        <p><strong>取象：</strong>${img.image}</p>
                                        <p><strong>解读：</strong>${img.interpretation}</p>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="info-item">
                                <h3>综合意象</h3>
                                <p>${result.xiangfaAnalysis.synthesis}</p>
                            </div>
                            <div class="info-item">
                                <h3>应用指导</h3>
                                <ul style="margin-left: 20px; line-height: 1.8;">
                                    ${result.xiangfaAnalysis.applications.map(app => `<li>${app}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                }

                if (result.jinglunAnalysis) {
                    html += `
                        <div class="result-card">
                            <h2>${result.jinglunAnalysis.title}</h2>
                            <h3 style="color: #4a5568; margin: 20px 0 15px 0; font-size: 1.2rem;">核心命理原则</h3>
                            <div style="margin-bottom: 20px;">
                                ${result.jinglunAnalysis.corePrinciples.map(principle => `
                                    <div class="info-item" style="margin-bottom: 15px;">
                                        <h4>${principle.principle}</h4>
                                        <p>${principle.analysis}</p>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="info-item">
                                <h3>生命格局模式</h3>
                                <p><strong>格局类型：</strong>${result.jinglunAnalysis.lifePattern.pattern}</p>
                                <p><strong>格局特征：</strong>${result.jinglunAnalysis.lifePattern.characteristics.join('、')}</p>
                                <p><strong>发展轨迹：</strong>${result.jinglunAnalysis.lifePattern.development}</p>
                            </div>
                            <div class="info-item">
                                <h3>人生智慧</h3>
                                <ul style="margin-left: 20px; line-height: 1.8;">
                                    ${result.jinglunAnalysis.wisdom.map(wis => `<li>${wis}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                }

                if (result.qicaiAnalysis) {
                    html += `
                        <div class="result-card">
                            <h2>${result.qicaiAnalysis.title}</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <div>
                                    <h3 style="color: #4a5568; margin-bottom: 15px;">婚姻分析</h3>
                                    <div class="info-item">
                                        <p><strong>配偶宫：</strong>${result.qicaiAnalysis.marriageAnalysis.spousePalace}</p>
                                        <p><strong>配偶特征：</strong>${result.qicaiAnalysis.marriageAnalysis.spouseCharacter}</p>
                                        <p><strong>婚姻质量：</strong>${result.qicaiAnalysis.marriageAnalysis.marriageQuality}</p>
                                        <p><strong>最佳婚期：</strong>${result.qicaiAnalysis.marriageAnalysis.marriageTiming}</p>
                                        <div style="margin-top: 10px;">
                                            <strong>婚姻建议：</strong>
                                            <ul style="margin-left: 20px; margin-top: 5px;">
                                                ${result.qicaiAnalysis.marriageAnalysis.marriageAdvice.map(advice => `<li>${advice}</li>`).join('')}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h3 style="color: #4a5568; margin-bottom: 15px;">财富分析</h3>
                                    <div class="info-item">
                                        <p><strong>财星：</strong>${result.qicaiAnalysis.wealthAnalysis.wealthElement}</p>
                                        <p><strong>财运质量：</strong>${result.qicaiAnalysis.wealthAnalysis.wealthQuality}</p>
                                        <p><strong>财富路径：</strong>${result.qicaiAnalysis.wealthAnalysis.wealthPath}</p>
                                        <p><strong>财运时机：</strong>${result.qicaiAnalysis.wealthAnalysis.wealthTiming}</p>
                                        <div style="margin-top: 10px;">
                                            <strong>财富建议：</strong>
                                            <ul style="margin-left: 20px; margin-top: 5px;">
                                                ${result.qicaiAnalysis.wealthAnalysis.wealthAdvice.map(advice => `<li>${advice}</li>`).join('')}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                if (result.liunianAnalysis) {
                    html += `
                        <div class="result-card">
                            <h2>${result.liunianAnalysis.title}</h2>
                            <div class="info-item">
                                <h3>${result.liunianAnalysis.currentYear.year}年 ${result.liunianAnalysis.currentYear.ganzhi}</h3>
                                <p>${result.liunianAnalysis.currentYear.analysis}</p>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                                <div class="info-item" style="border-left: 4px solid #48bb78;">
                                    <h4>发展机遇</h4>
                                    <ul style="margin-left: 20px; line-height: 1.8;">
                                        ${result.liunianAnalysis.currentYear.opportunities.map(opp => `<li>${opp}</li>`).join('')}
                                    </ul>
                                </div>
                                <div class="info-item" style="border-left: 4px solid #f56565;">
                                    <h4>注意事项</h4>
                                    <ul style="margin-left: 20px; line-height: 1.8;">
                                        ${result.liunianAnalysis.currentYear.challenges.map(chal => `<li>${chal}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                            <div class="info-item">
                                <h3>季度重点</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                    ${result.liunianAnalysis.currentYear.monthlyFocus.map(month => `
                                        <div style="padding: 10px; background: #f7fafc; border-radius: 5px;">
                                            <strong>${month.month}：</strong>${month.focus}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }

                if (result.anliAnalysis) {
                    html += `
                        <div class="result-card">
                            <h2>${result.anliAnalysis.title}</h2>
                            <h3 style="color: #4a5568; margin: 20px 0 15px 0; font-size: 1.2rem;">相似案例对比</h3>
                            ${result.anliAnalysis.similarCases.map((case_, index) => `
                                <div class="info-item" style="margin-bottom: 20px;">
                                    <h4>案例${index + 1}：${case_.case}</h4>
                                    <p><strong>八字：</strong>${case_.bazi}</p>
                                    <p><strong>相似度：</strong>${case_.similarity}</p>
                                    <p><strong>人生结局：</strong>${case_.outcome}</p>
                                    <p><strong>启示：</strong>${case_.enlightenment}</p>
                                </div>
                            `).join('')}
                            <div class="info-item">
                                <h3>验证结论</h3>
                                <p>${result.anliAnalysis.validation}</p>
                                <p><strong>${result.anliAnalysis.confidence}</strong></p>
                            </div>
                        </div>
                    `;
                }

                // 基础分析结果（处理原有数据结构）
                if (result.siZhu) {
                    html += this.generateBasicAnalysisHTML(result);
                }

                // 综合建议
                if (result.comprehensiveAdvice) {
                    html += `
                        <div class="result-card">
                            <h2>综合建议</h2>
                            <div class="info-item">
                                <h3>总体评价</h3>
                                <p>${result.comprehensiveAdvice.summary}</p>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                <div class="info-item" style="border-left: 4px solid #48bb78;">
                                    <h4>优势特征</h4>
                                    <ul style="margin-left: 20px; line-height: 1.8;">
                                        ${result.comprehensiveAdvice.strengths.map(str => `<li>${str}</li>`).join('')}
                                    </ul>
                                </div>
                                <div class="info-item" style="border-left: 4px solid #4299e1;">
                                    <h4>发展重点</h4>
                                    <ul style="margin-left: 20px; line-height: 1.8;">
                                        ${result.comprehensiveAdvice.focus.map(foc => `<li>${foc}</li>`).join('')}
                                    </ul>
                                </div>
                                <div class="info-item" style="border-left: 4px solid #f56565;">
                                    <h4>注意事项</h4>
                                    <ul style="margin-left: 20px; line-height: 1.8;">
                                        ${result.comprehensiveAdvice.caution.map(cau => `<li>${cau}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `;
                }

                this.resultsContent.innerHTML = html;
                this.showSuccess('八字分析完成！请查看详细结果。');
                this.resultsSection.scrollIntoView({ behavior: 'smooth' });
            }

            // 生成基础分析HTML
            generateBasicAnalysisHTML(result) {
                return `
                    <!-- 四柱排盘 -->
                    <div class="result-card">
                        <h2>四柱排盘</h2>
                        <div class="si-zhu-grid">
                            <div class="pillar">
                                <div class="pillar-title">年柱</div>
                                <div class="pillar-ganzhi">年</div>
                                <div class="pillar-nayin">${result.siZhu.yearPillar.description}</div>
                            </div>
                            <div class="pillar">
                                <div class="pillar-title">月柱</div>
                                <div class="pillar-ganzhi">月</div>
                                <div class="pillar-nayin">${result.siZhu.monthPillar.description}</div>
                            </div>
                            <div class="pillar">
                                <div class="pillar-title">日柱</div>
                                <div class="pillar-ganzhi">日</div>
                                <div class="pillar-nayin">${result.siZhu.dayPillar.description}</div>
                            </div>
                            <div class="pillar">
                                <div class="pillar-title">时柱</div>
                                <div class="pillar-ganzhi">时</div>
                                <div class="pillar-nayin">${result.siZhu.hourPillar.description}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            new BaziWebFrontend();
        });

        // 设置今天日期为默认值
        document.addEventListener('DOMContentLoaded', () => {
            const birthDateInput = document.getElementById('birthDate');
            if (birthDateInput) {
                const today = new Date().toISOString().split('T')[0];
                birthDateInput.max = today;
            }
        });
    </script>
</body>
</html>