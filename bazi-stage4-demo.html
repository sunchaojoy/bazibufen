<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬å››é˜¶æ®µå®æˆ˜æŠ€æ³•å…«å­—åˆ†æç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .app-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-content h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .feature-badges {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section-container {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .section-container:hover {
            transform: translateY(-5px);
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .icon {
            font-size: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select {
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .optional-inputs {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .primary-btn,
        .secondary-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .primary-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .secondary-btn {
            background: #6c757d;
            color: white;
        }

        .secondary-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .method-selection {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .method-selection h3 {
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .method-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .method-option {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .method-option:hover {
            border-color: #667eea;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.1);
        }

        .method-option input[type="checkbox"] {
            margin-top: 0.2rem;
        }

        .method-name {
            font-weight: 600;
            color: #2c3e50;
            display: block;
            margin-bottom: 0.3rem;
        }

        .method-desc {
            font-size: 0.9rem;
            color: #666;
        }

        .analysis-progress {
            margin-bottom: 2rem;
        }

        .progress-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-weight: 600;
            color: #667eea;
        }

        .analysis-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .step {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .step.processing {
            border-color: #ffc107;
            background: #fff3cd;
        }

        .step.completed {
            border-color: #28a745;
            background: #d4edda;
        }

        .step-icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .step-text {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .step-status {
            font-size: 0.8rem;
            color: #666;
        }

        .results-container {
            min-height: 200px;
        }

        .placeholder {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .placeholder-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .analysis-results {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .result-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: #2c3e50;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .result-title:hover {
            color: #667eea;
        }

        .result-content {
            line-height: 1.6;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-item .label {
            font-weight: 600;
            color: #555;
        }

        .info-item .value {
            color: #2c3e50;
        }

        .bazi-display {
            font-family: 'KaiTi', 'æ¥·ä½“', serif;
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        .xiang-analysis {
            display: grid;
            gap: 1rem;
        }

        .xiang-category {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .xiang-category h4 {
            margin-bottom: 0.8rem;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .xiang-items {
            display: grid;
            gap: 0.5rem;
        }

        .xiang-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .pillar-name {
            font-weight: 600;
            color: #667eea;
            min-width: 60px;
        }

        .xiang-content {
            color: #555;
            flex: 1;
        }

        .xiang-images {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .image-tag {
            background: #667eea;
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        .philosophy-items {
            display: grid;
            gap: 0.8rem;
        }

        .philosophy-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .concept {
            font-weight: 600;
            color: #667eea;
            min-width: 80px;
        }

        .explanation {
            color: #555;
            flex: 1;
        }

        .bingyao-result,
        .qixing-result,
        .caixing-result {
            display: grid;
            gap: 0.5rem;
        }

        .bing,
        .yao,
        .plan,
        .qixing-detail,
        .caixing-detail {
            padding: 0.8rem;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        .validation-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .metric {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .metric-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 0.3rem;
        }

        .metric-value {
            font-size: 1.2rem;
            color: #667eea;
            font-weight: bold;
        }

        .validation-advice {
            background: #fff3cd;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .comprehensive-advice {
            display: grid;
            gap: 1rem;
        }

        .advice-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .advice-title {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            font-weight: 600;
        }

        .advice-content {
            color: #555;
            line-height: 1.5;
        }

        .results-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .export-btn,
        .print-btn,
        .share-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .export-btn {
            background: #28a745;
            color: white;
        }

        .export-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .print-btn {
            background: #17a2b8;
            color: white;
        }

        .print-btn:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .share-btn {
            background: #6f42c1;
            color: white;
        }

        .share-btn:hover {
            background: #5a32a3;
            transform: translateY(-2px);
        }

        .history-controls {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .clear-history-btn,
        .export-history-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-history-btn {
            background: #dc3545;
            color: white;
        }

        .clear-history-btn:hover {
            background: #c82333;
        }

        .export-history-btn {
            background: #007bff;
            color: white;
        }

        .export-history-btn:hover {
            background: #0056b3;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .history-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .history-date {
            font-size: 0.9rem;
            color: #666;
        }

        .history-bazi {
            font-family: 'KaiTi', 'æ¥·ä½“', serif;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .history-actions {
            display: flex;
            gap: 0.5rem;
        }

        .view-btn,
        .delete-btn {
            padding: 0.3rem 0.8rem;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-btn {
            background: #28a745;
            color: white;
        }

        .view-btn:hover {
            background: #218838;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .help-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-btn:hover {
            color: #667eea;
        }

        .help-panels {
            position: relative;
        }

        .help-panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .help-panel.active {
            display: block;
        }

        .help-panel h3 {
            margin-bottom: 1rem;
            color: #2c3e50;
        }

        .help-panel ul,
        .help-panel ol {
            margin-left: 2rem;
            line-height: 1.6;
        }

        .help-panel li {
            margin-bottom: 0.5rem;
        }

        .method-descriptions {
            display: grid;
            gap: 1rem;
        }

        .method-desc {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .method-desc h4 {
            margin-bottom: 0.5rem;
            color: #667eea;
        }

        .case-showcases {
            display: grid;
            gap: 1rem;
        }

        .showcase {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .showcase h4 {
            margin-bottom: 0.5rem;
            color: #667eea;
        }

        .showcase p {
            margin-bottom: 0.5rem;
            color: #555;
        }

        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .message-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .message-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }

            .section-container {
                padding: 1.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .analysis-steps {
                grid-template-columns: repeat(2, 1fr);
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .method-options {
                grid-template-columns: 1fr;
            }

            .help-tabs {
                flex-wrap: wrap;
            }
        }

        @media print {
            body {
                background: white;
            }

            .app-header,
            .form-actions,
            .results-actions,
            .history-controls,
            .help-section {
                display: none;
            }

            .section-container {
                box-shadow: none;
                border: 1px solid #ccc;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="header-content">
            <h1 class="app-title">
                <span class="title-icon">ğŸ¯</span>
                ç¬¬å››é˜¶æ®µå®æˆ˜æŠ€æ³•å…«å­—åˆ†æç³»ç»Ÿ
            </h1>
            <div class="subtitle">
                åŸºäºã€Šæ¢ç´¢é—¨å…«å­—å–è±¡ç§˜æ³•ã€‹ç­‰äº”æœ¬ç»å…¸è‘—ä½œçš„ç»¼åˆå®æˆ˜æŠ€æ³•åˆ†æ
            </div>
            <div class="feature-badges">
                <span class="badge">å–è±¡åˆ†æ</span>
                <span class="badge">å¦»è´¢ä¸“é¡¹</span>
                <span class="badge">æµå¹´å®åŠ¡</span>
                <span class="badge">æ¡ˆä¾‹éªŒè¯</span>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- è¾“å…¥åŒºåŸŸ -->
        <section class="input-section">
            <div class="section-container">
                <h2 class="section-title">
                    <span class="icon">ğŸ“</span>
                    åŸºæœ¬ä¿¡æ¯è¾“å…¥
                </h2>

                <form id="bazi-form" class="bazi-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name">å§“åï¼š</label>
                            <input type="text" id="name" placeholder="è¯·è¾“å…¥å§“å" required>
                        </div>

                        <div class="form-group">
                            <label for="gender">æ€§åˆ«ï¼š</label>
                            <select id="gender" required>
                                <option value="ç”·">ç”·</option>
                                <option value="å¥³">å¥³</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="birth-date">å‡ºç”Ÿæ—¥æœŸï¼š</label>
                            <input type="date" id="birth-date" required>
                        </div>

                        <div class="form-group">
                            <label for="birth-time">å‡ºç”Ÿæ—¶é—´ï¼š</label>
                            <input type="time" id="birth-time" required>
                        </div>
                    </div>

                    <div class="form-row optional-inputs">
                        <div class="form-group">
                            <label for="liu-nian">æµå¹´ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                            <input type="text" id="liu-nian" placeholder="å¦‚ï¼šç”²è¾° 2024">
                        </div>

                        <div class="form-group">
                            <label for="focus">åˆ†æé‡ç‚¹ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                            <select id="focus">
                                <option value="ç»¼åˆ">ç»¼åˆåˆ†æ</option>
                                <option value="å–è±¡">å–è±¡åˆ†æ</option>
                                <option value="å¦»è´¢">å¦»è´¢åˆ†æ</option>
                                <option value="æµå¹´">æµå¹´åˆ†æ</option>
                                <option value="äº‹ä¸š">äº‹ä¸šå‘å±•</option>
                                <option value="å©šå§»">å©šå§»æ„Ÿæƒ…</option>
                                <option value="å¥åº·">å¥åº·å…»ç”Ÿ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="analyze-btn primary-btn">
                            <span class="btn-icon">ğŸ”®</span>
                            å¼€å§‹å®æˆ˜æŠ€æ³•åˆ†æ
                        </button>
                        <button type="button" class="demo-btn secondary-btn" id="demo-btn">
                            <span class="btn-icon">ğŸ²</span>
                            åŠ è½½æ¼”ç¤ºæ¡ˆä¾‹
                        </button>
                        <button type="button" class="clear-btn secondary-btn" id="clear-btn">
                            <span class="btn-icon">ğŸ”„</span>
                            æ¸…ç©ºé‡ç½®
                        </button>
                    </div>
                </form>

                <!-- åˆ†ææ–¹æ³•é€‰æ‹© -->
                <div class="method-selection">
                    <h3>å®æˆ˜æŠ€æ³•åˆ†ææ–¹æ³•</h3>
                    <div class="method-options">
                        <label class="method-option">
                            <input type="checkbox" name="methods" value="xiangfa" checked>
                            <span class="method-name">æ¢ç´¢é—¨å–è±¡æ³•</span>
                            <span class="method-desc">ç‹åº†è‘—ï¼Œç²¾å‡†å–è±¡åˆ†æ</span>
                        </label>
                        <label class="method-option">
                            <input type="checkbox" name="methods" value="jinglun" checked>
                            <span class="method-name">å‘½ç†ç²¾è®º</span>
                            <span class="method-desc">èƒ¡ä¸€é¸£è‘—ï¼Œå“²å­¦æ€æƒ³åˆ†æ</span>
                        </label>
                        <label class="method-option">
                            <input type="checkbox" name="methods" value="qicai" checked>
                            <span class="method-name">ç‚¹ç®—å…«å­—å¦»è´¢</span>
                            <span class="method-desc">ç½—é‡è‘—ï¼Œå¦»è´¢ä¸“é¡¹åˆ†æ</span>
                        </label>
                        <label class="method-option">
                            <input type="checkbox" name="methods" value="liunian" checked>
                            <span class="method-name">æµå¹´å®åŠ¡</span>
                            <span class="method-desc">æ½˜ä¸œå…‰è‘—ï¼Œæµå¹´é¢„æµ‹å®åŠ¡</span>
                        </label>
                        <label class="method-option">
                            <input type="checkbox" name="methods" value="anli" checked>
                            <span class="method-name">æ¡ˆä¾‹éªŒè¯</span>
                            <span class="method-desc">ææœˆæœ¨è‘—ï¼Œæ¡ˆä¾‹å¯¹æ¯”éªŒè¯</span>
                        </label>
                    </div>
                </div>
            </div>
        </section>

        <!-- åˆ†æè¿‡ç¨‹åŒºåŸŸ -->
        <section class="analysis-section">
            <div class="section-container">
                <h2 class="section-title">
                    <span class="icon">âš¡</span>
                    å®æˆ˜æŠ€æ³•åˆ†æè¿‡ç¨‹
                </h2>

                <div class="analysis-progress" id="analysis-progress" style="display: none;">
                    <div class="progress-header">
                        <h3>æ­£åœ¨è¿›è¡Œå®æˆ˜æŠ€æ³•åˆ†æ...</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text" id="progress-text">å‡†å¤‡ä¸­...</div>
                    </div>

                    <div class="analysis-steps">
                        <div class="step" id="step-paipan">
                            <span class="step-icon">ğŸ“Š</span>
                            <span class="step-text">å…«å­—æ’ç›˜</span>
                            <span class="step-status">pending</span>
                        </div>
                        <div class="step" id="step-xiangfa">
                            <span class="step-icon">ğŸ¨</span>
                            <span class="step-text">æ¢ç´¢é—¨å–è±¡åˆ†æ</span>
                            <span class="step-status">pending</span>
                        </div>
                        <div class="step" id="step-jinglun">
                            <span class="step-icon">ğŸ“š</span>
                            <span class="step-text">å‘½ç†ç²¾è®ºåˆ†æ</span>
                            <span class="step-status">pending</span>
                        </div>
                        <div class="step" id="step-qicai">
                            <span class="step-icon">ğŸ’°</span>
                            <span class="step-text">å¦»è´¢ä¸“é¡¹åˆ†æ</span>
                            <span class="step-status">pending</span>
                        </div>
                        <div class="step" id="step-liunian">
                            <span class="step-icon">ğŸ“…</span>
                            <span class="step-text">æµå¹´å®åŠ¡åˆ†æ</span>
                            <span class="step-status">pending</span>
                        </div>
                        <div class="step" id="step-anli">
                            <span class="step-icon">ğŸ”</span>
                            <span class="step-text">æ¡ˆä¾‹éªŒè¯</span>
                            <span class="step-status">pending</span>
                        </div>
                        <div class="step" id="step-zonghe">
                            <span class="step-icon">ğŸ¯</span>
                            <span class="step-text">ç»¼åˆå»ºè®®</span>
                            <span class="step-status">pending</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
        <section class="results-section">
            <div class="section-container">
                <h2 class="section-title">
                    <span class="icon">ğŸ“‹</span>
                    å®æˆ˜æŠ€æ³•åˆ†æç»“æœ
                </h2>

                <div class="results-container" id="results-container">
                    <div class="placeholder">
                        <div class="placeholder-icon">ğŸ“</div>
                        <p>è¯·è¾“å…¥åŸºæœ¬ä¿¡æ¯å¹¶ç‚¹å‡»"å¼€å§‹å®æˆ˜æŠ€æ³•åˆ†æ"æŒ‰é’®</p>
                    </div>
                </div>

                <!-- ç»“æœæ“ä½œæŒ‰é’® -->
                <div class="results-actions" id="results-actions" style="display: none;">
                    <button class="export-btn" id="export-btn">
                        <span class="btn-icon">ğŸ’¾</span>
                        å¯¼å‡ºåˆ†ææŠ¥å‘Š
                    </button>
                    <button class="print-btn" id="print-btn">
                        <span class="btn-icon">ğŸ–¨ï¸</span>
                        æ‰“å°æŠ¥å‘Š
                    </button>
                    <button class="share-btn" id="share-btn">
                        <span class="btn-icon">ğŸ”—</span>
                        åˆ†äº«ç»“æœ
                    </button>
                </div>
            </div>
        </section>

        <!-- å†å²è®°å½•åŒºåŸŸ -->
        <section class="history-section">
            <div class="section-container">
                <h2 class="section-title">
                    <span class="icon">ğŸ“š</span>
                    åˆ†æå†å²è®°å½•
                </h2>

                <div class="history-controls">
                    <button class="clear-history-btn" id="clear-history-btn">
                        <span class="btn-icon">ğŸ—‘ï¸</span>
                        æ¸…ç©ºå†å²
                    </button>
                    <button class="export-history-btn" id="export-history-btn">
                        <span class="btn-icon">ğŸ“¤</span>
                        å¯¼å‡ºå†å²
                    </button>
                </div>

                <div class="history-list" id="history-list">
                    <div class="placeholder">
                        <p>æš‚æ— åˆ†æå†å²</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- å¸®åŠ©åŒºåŸŸ -->
        <section class="help-section">
            <div class="section-container">
                <h2 class="section-title">
                    <span class="icon">â“</span>
                    å®æˆ˜æŠ€æ³•ä½¿ç”¨æŒ‡å—
                </h2>

                <div class="help-content">
                    <div class="help-tabs">
                        <button class="tab-btn active" data-tab="overview">ç³»ç»Ÿæ¦‚è¿°</button>
                        <button class="tab-btn" data-tab="methods">æ–¹æ³•ä»‹ç»</button>
                        <button class="tab-btn" data-tab="usage">ä½¿ç”¨è¯´æ˜</button>
                        <button class="tab-btn" data-tab="cases">æ¡ˆä¾‹å±•ç¤º</button>
                    </div>

                    <div class="help-panels">
                        <div class="help-panel active" id="panel-overview">
                            <h3>ç¬¬å››é˜¶æ®µå®æˆ˜æŠ€æ³•ç³»ç»Ÿæ¦‚è¿°</h3>
                            <p>æœ¬ç³»ç»ŸåŸºäºäº”æœ¬ç»å…¸å®æˆ˜æŠ€æ³•è‘—ä½œï¼Œæä¾›ä¸“ä¸šçš„å…«å­—åˆ†ææœåŠ¡ï¼š</p>
                            <ul>
                                <li><strong>æ¢ç´¢é—¨å–è±¡æ³•</strong> - ç‹åº†è‘—ï¼Œç²¾å‡†çš„æ„è±¡è§£è¯»æŠ€æ³•</li>
                                <li><strong>å‘½ç†ç²¾è®º</strong> - èƒ¡ä¸€é¸£è‘—ï¼Œæ·±åˆ»çš„å‘½ç†å“²å­¦æ€æƒ³</li>
                                <li><strong>ç‚¹ç®—å…«å­—å¦»è´¢</strong> - ç½—é‡è‘—ï¼Œä¸“é¡¹çš„å¦»è´¢å­ç¦„åˆ†æ</li>
                                <li><strong>å…«å­—æ‰¹æµå¹´å®åŠ¡</strong> - æ½˜ä¸œå…‰è‘—ï¼Œå®ç”¨çš„æµå¹´é¢„æµ‹æ–¹æ³•</li>
                                <li><strong>å‘½ç†ç²¾è§£äºŒç™¾ä¾‹</strong> - ææœˆæœ¨è‘—ï¼Œä¸°å¯Œçš„æ¡ˆä¾‹éªŒè¯ç³»ç»Ÿ</li>
                            </ul>
                        </div>

                        <div class="help-panel" id="panel-methods">
                            <h3>å®æˆ˜æŠ€æ³•æ–¹æ³•ä»‹ç»</h3>
                            <div class="method-descriptions">
                                <div class="method-desc">
                                    <h4>ğŸ¨ æ¢ç´¢é—¨å–è±¡æ³•</h4>
                                    <p>é€šè¿‡å¤©å¹²åœ°æ”¯ã€åç¥ã€å®«ä½ç­‰è¿›è¡Œç²¾å‡†å–è±¡ï¼Œæ­ç¤ºå‘½å±€çš„æ·±å±‚å«ä¹‰ã€‚</p>
                                </div>
                                <div class="method-desc">
                                    <h4>ğŸ“š å‘½ç†ç²¾è®º</h4>
                                    <p>è¿ç”¨å“²å­¦æ€ç»´åˆ†æå‘½ç†ï¼Œæä¾›å¤©äººåˆä¸€ã€é˜´é˜³å¹³è¡¡çš„æ·±åˆ»è§è§£ã€‚</p>
                                </div>
                                <div class="method-desc">
                                    <h4>ğŸ’° ç‚¹ç®—å…«å­—å¦»è´¢</h4>
                                    <p>ä¸“é—¨åˆ†æå¦»è´¢å­ç¦„ç­‰äººç”Ÿé‡è¦æ–¹é¢ï¼Œæä¾›è¯¦ç»†çš„é¢„æµ‹å’Œå»ºè®®ã€‚</p>
                                </div>
                                <div class="method-desc">
                                    <h4>ğŸ“… æµå¹´å®åŠ¡</h4>
                                    <p>åˆ†ææµå¹´å¯¹å‘½å±€çš„å½±å“ï¼Œé¢„æµ‹å¹´åº¦è¿åŠ¿å’Œé‡è¦æ—¶æœºã€‚</p>
                                </div>
                                <div class="method-desc">
                                    <h4>ğŸ” æ¡ˆä¾‹éªŒè¯</h4>
                                    <p>é€šè¿‡å¤§é‡ç»å…¸æ¡ˆä¾‹éªŒè¯åˆ†æç»“æœï¼Œæé«˜é¢„æµ‹å‡†ç¡®æ€§ã€‚</p>
                                </div>
                            </div>
                        </div>

                        <div class="help-panel" id="panel-usage">
                            <h3>ä½¿ç”¨è¯´æ˜</h3>
                            <ol>
                                <li>è¾“å…¥å§“åã€æ€§åˆ«ã€å‡ºç”Ÿæ—¥æœŸå’Œæ—¶é—´</li>
                                <li>å¯é€‰æ‹©è¾“å…¥æµå¹´è¿›è¡Œæµå¹´åˆ†æ</li>
                                <li>é€‰æ‹©åˆ†æé‡ç‚¹å’Œå®æˆ˜æŠ€æ³•æ–¹æ³•</li>
                                <li>ç‚¹å‡»"å¼€å§‹å®æˆ˜æŠ€æ³•åˆ†æ"æŒ‰é’®</li>
                                <li>æŸ¥çœ‹è¯¦ç»†çš„åˆ†æç»“æœå’Œå»ºè®®</li>
                                <li>å¯å¯¼å‡ºæŠ¥å‘Šæˆ–ä¿å­˜åˆ°å†å²è®°å½•</li>
                            </ol>
                        </div>

                        <div class="help-panel" id="panel-cases">
                            <h3>æ¡ˆä¾‹å±•ç¤º</h3>
                            <div class="case-showcases">
                                <div class="showcase">
                                    <h4>äº‹ä¸šæˆåŠŸæ¡ˆä¾‹</h4>
                                    <p>å…«å­—ï¼šç”²æˆŒ ä¸™å¯… ç”²å­ ä¸™å¯…</p>
                                    <p>é€šè¿‡æ¢ç´¢é—¨å–è±¡æ³•å’Œå‘½ç†ç²¾è®ºåˆ†æï¼Œè¯†åˆ«å‡ºè´¢å®˜å°å…¨çš„æ ¼å±€ï¼Œæä¾›äº†äº‹ä¸šå‘å±•å»ºè®®ã€‚</p>
                                </div>
                                <div class="showcase">
                                    <h4>å©šå§»ç¾æ»¡æ¡ˆä¾‹</h4>
                                    <p>å…«å­—ï¼šä¸™æˆŒ åºšå¯… ç™¸å¯ å£¬åˆ</p>
                                    <p>é€šè¿‡å¦»è´¢ä¸“é¡¹åˆ†æå’Œæ¡ˆä¾‹éªŒè¯ï¼Œåˆ†æå©šå§»çŠ¶å†µï¼Œæä¾›äº†æ„Ÿæƒ…ç»è¥å»ºè®®ã€‚</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- å¼•å…¥JavaScript -->
    <script src="bazi-practical-techniques-app.js"></script>
    <script>
        // æ¨¡æ‹Ÿç¬¬å››é˜¶æ®µå®æˆ˜æŠ€æ³•ç³»ç»Ÿ
        const stage04System = {
            // ç»¼åˆåˆ†æä¸»å‡½æ•°
            comprehensiveAnalysis: function(bazi, options = {}) {
                const analysis = {
                    åŸºæœ¬ä¿¡æ¯: {
                        å§“å: options.name || 'æœªæä¾›',
                        æ€§åˆ«: options.gender || 'ç”·',
                        å‡ºç”Ÿæ—¥æœŸ: options.birthDateTime || 'æœªæä¾›',
                        å…«å­—: this.formatBazi(bazi)
                    },

                    // æ¢ç´¢é—¨å–è±¡åˆ†æ
                    å–è±¡åˆ†æ: this.performXiangAnalysis(bazi),

                    // å‘½ç†ç²¾è®ºåˆ†æ
                    ç²¾è®ºåˆ†æ: this.performJinglunAnalysis(bazi),

                    // å¦»è´¢ä¸“é¡¹åˆ†æ
                    å¦»è´¢åˆ†æ: this.performQicaiAnalysis(bazi, options.gender),

                    // æµå¹´å®åŠ¡åˆ†æï¼ˆå¦‚æœæä¾›æµå¹´ï¼‰
                    æµå¹´åˆ†æ: options.liuNian ? this.performLiunianAnalysis(bazi, options.liuNian) : {},

                    // æ¡ˆä¾‹éªŒè¯
                    æ¡ˆä¾‹éªŒè¯: this.performCaseValidation(bazi),

                    // ç»¼åˆå»ºè®®
                    ç»¼åˆå»ºè®®: this.generateComprehensiveAdvice(bazi, options)
                };

                return analysis;
            },

            // å–è±¡æ³•åˆ†æ
            performXiangAnalysis: function(bazi) {
                const analysis = {
                    åç¥å–è±¡: {},
                    å¹²æ”¯å–è±¡: {},
                    å®«ä½å–è±¡: {},
                    ç»„åˆå–è±¡: [],
                    ç»¼åˆæ„è±¡: []
                };

                // åç¥å–è±¡åˆ†æ
                ['year', 'month', 'day', 'hour'].forEach(pillar => {
                    const tianGan = bazi[pillar].å¤©å¹²;
                    const diZhi = bazi[pillar].åœ°æ”¯;
                    const shiShen = bazi[pillar].åç¥;

                    analysis.åç¥å–è±¡[pillar] = this.getShiShenXiang(shiShen);
                    analysis.å¹²æ”¯å–è±¡[pillar] = {
                        å¤©å¹²: this.getTianGanXiang(tianGan),
                        åœ°æ”¯: this.getDiZhiXiang(diZhi)
                    };
                });

                // å®«ä½å–è±¡
                analysis.å®«ä½å–è±¡ = {
                    å¹´æŸ±: "ç¥–ä¸Šã€çˆ¶æ¯ã€1-16å²ã€è¿œæ–¹ã€å¤©å‘½ã€æ ¹æœ¬",
                    æœˆæŸ±: "çˆ¶æ¯ã€å…„å¼Ÿã€17-32å²ã€äº‹ä¸šã€é¢†å¯¼ã€ç¤¾ä¼š",
                    æ—¥æŸ±: "è‡ªå·±ã€é…å¶ã€33-48å²ã€å©šå§»ã€å®¶åº­ã€å†…åœ¨",
                    æ—¶æŸ±: "å­å¥³ã€ä¸‹å±ã€49å²åã€æˆå°±ã€æ™šå¹´ã€å½’å®¿"
                };

                // ç”Ÿæˆç»¼åˆæ„è±¡
                analysis.ç»¼åˆæ„è±¡ = this.generateComprehensiveImages(analysis);

                return analysis;
            },

            // ç²¾è®ºæ³•åˆ†æ
            performJinglunAnalysis: function(bazi) {
                return {
                    å“²å­¦æ€æƒ³: {
                        å¤©äººåˆä¸€: "å‘½å±€åæ˜ å®‡å®™ä¿¡æ¯ï¼Œé¡ºåº”è‡ªç„¶è§„å¾‹",
                        é˜´é˜³å¹³è¡¡: "è¿½æ±‚å‘½å±€äº”è¡Œå¹³è¡¡ï¼Œå’Œè°å‘å±•",
                        ç³»ç»Ÿæ€ç»´: "å…«å­—ä¸ºå®Œæ•´ç³»ç»Ÿï¼Œå„éƒ¨åˆ†ç›¸äº’å½±å“",
                        è¾©è¯æ€ç»´: "å‰å‡¶ç›¸å¯¹ï¼Œå¯ä»¥ç›¸äº’è½¬åŒ–"
                    },
                    ç—…è¯åˆ†æ: {
                        å‘½å±€ä¹‹ç—…: ["èº«å¼±"],
                        å¯¹ç—‡ä¹‹è¯: ["å°æ¯”"],
                        æ²»ç–—æ–¹æ¡ˆ: ["åŠ å¼ºè‡ªèº«åŠ›é‡"]
                    },
                    è°ƒå€™åˆ†æ: {
                        æœˆä»¤: bazi.month.åœ°æ”¯,
                        è°ƒå€™ç”¨ç¥: "ç«",
                        è°ƒå€™åŸç†: "æ ¹æ®æœˆä»¤æ°”å€™ç‰¹ç‚¹é€‰æ‹©ç”¨ç¥",
                        è°ƒå€™æ•ˆæœ: "å¹³è¡¡å‘½å±€å¯’æš–ç‡¥æ¹¿"
                    },
                    æ ¼å±€åˆ†æ: {
                        ä¸»è¦æ ¼å±€: "æ­£æ ¼",
                        æ ¼å±€è´¨é‡: "ä¸­ç­‰",
                        æˆæ ¼æ¡ä»¶: "åŸºæœ¬æ»¡è¶³"
                    }
                };
            },

            // å¦»è´¢ä¸“é¡¹åˆ†æ
            performQicaiAnalysis: function(bazi, gender) {
                return {
                    å¦»æ˜Ÿåˆ†æ: this.analyzeQiXing(bazi, gender),
                    è´¢æ˜Ÿåˆ†æ: this.analyzeCaiXing(bazi),
                    å­å¥³åˆ†æ: this.analyzeZiNv(bazi, gender)
                };
            },

            // æµå¹´å®åŠ¡åˆ†æ
            performLiunianAnalysis: function(bazi, liuNian) {
                return {
                    æµå¹´æ€»è¯„: {
                        æµå¹´: liuNian,
                        æ€»ä½“è¯„ä»·: "ä¸­ç­‰",
                        æ³¨æ„äº‹é¡¹: ["è°¨æ…æŠ•èµ„", "æ³¨æ„å¥åº·"]
                    },
                    æµå¹´å–è±¡: {
                        å¤©å¹²ä¹‹è±¡: "å‘å±•æœºé‡",
                        åœ°æ”¯ä¹‹è±¡: "å˜åŒ–è°ƒæ•´"
                    },
                    åº”æœŸåˆ¤æ–­: {
                        åº”æœŸ: "å¹´ä¸­",
                        äº‹ä»¶: "äº‹ä¸šå˜åŠ¨"
                    },
                    è¶‹é¿å»ºè®®: {
                        å®œ: "ç§¯æè¿›å–",
                        å¿Œ: "å†’é™©æŠ•èµ„"
                    }
                };
            },

            // æ¡ˆä¾‹éªŒè¯
            performCaseValidation: function(bazi) {
                return {
                    ç›¸ä¼¼æ¡ˆä¾‹: [
                        {
                            å§“å: "æŸä¼ä¸šå®¶",
                            å…«å­—: "ç”²æˆŒ ä¸™å¯… ç”²å­ ä¸™å¯…",
                            ç›¸ä¼¼åº¦: "85%"
                        },
                        {
                            å§“å: "æŸèŒåœºäººå£«",
                            å…«å­—: "ä¹™å¯ ä¹™é…‰ ä¹™ä¸‘ ä¸å·³",
                            ç›¸ä¼¼åº¦: "75%"
                        }
                    ],
                    ç¬¦åˆåº¦: "80%",
                    éªŒè¯å»ºè®®: "å»ºè®®ç»§ç»­è§‚å¯Ÿå’ŒéªŒè¯"
                };
            },

            // ç”Ÿæˆç»¼åˆå»ºè®®
            generateComprehensiveAdvice: function(bazi, options) {
                return {
                    äººç”Ÿè§„åˆ’: "ç¨³æ‰ç¨³æ‰“ï¼Œå¾ªåºæ¸è¿›ï¼ŒæŠŠæ¡å‘å±•æœºé‡",
                    äº‹ä¸šå‘å±•: "é€‚åˆæŠ€æœ¯æˆ–ç®¡ç†å²—ä½ï¼Œå‘æŒ¥ä¸ªäººä¼˜åŠ¿",
                    å©šå§»æ„Ÿæƒ…: "æ„Ÿæƒ…éœ€è¦ç»è¥ï¼Œé‡è§†å®¶åº­å’Œè°",
                    è´¢å¯Œç®¡ç†: "ç¨³å¥ç†è´¢ï¼Œé¿å…å†’é™©ï¼Œæ³¨é‡ç§¯ç´¯",
                    å¥åº·å…»ç”Ÿ: "æ³¨æ„ä½œæ¯è§„å¾‹ï¼Œä¿æŒèº«å¿ƒå¥åº·",
                    å¼€è¿å»ºè®®: "ä¸œå—æ–¹å‘æœ‰åˆ©ï¼Œå¯è°ƒæ•´å±…ä½ç¯å¢ƒ"
                };
            },

            // è¾…åŠ©æ–¹æ³•
            formatBazi: function(bazi) {
                return {
                    å¹´æŸ±: `${bazi.year.å¤©å¹²}${bazi.year.åœ°æ”¯}`,
                    æœˆæŸ±: `${bazi.month.å¤©å¹²}${bazi.month.åœ°æ”¯}`,
                    æ—¥æŸ±: `${bazi.day.å¤©å¹²}${bazi.day.åœ°æ”¯}`,
                    æ—¶æŸ±: `${bazi.hour.å¤©å¹²}${bazi.hour.åœ°æ”¯}`
                };
            },

            getShiShenXiang: function(shiShen) {
                const shiShenMap = {
                    'æ­£å®˜': ['å®˜èŒ', 'åœ°ä½', 'çº¦æŸ', 'è§„å¾‹', 'ä¸ˆå¤«', 'å¥³å„¿'],
                    'ä¸ƒæ€': ['æƒåŠ›', 'å¨ä¸¥', 'å°äºº', 'æ•Œäºº', 'å„¿å­', 'å‹åŠ›'],
                    'æ­£è´¢': ['å¦»å­', 'çˆ¶äº²', 'è´¢äº§', 'å¯Œè£•', 'å‹¤ä¿­', 'ç°å®'],
                    'åè´¢': ['å¦¾', 'çˆ¶äº²', 'æ¨ªè´¢', 'æŠ•æœº', 'äº¤é™…', 'å¥¢ä¾ˆ'],
                    'æ­£å°': ['æ¯äº²', 'å­¦ä¹ ', 'æ–‡ä¹¦', 'æˆ¿å­', 'ä¿æŠ¤', 'ä¾é '],
                    'åå°': ['ç»§æ¯', 'éä¸»æµ', 'ç„å­¦', 'åŒ»è¯', 'å­¤ç‹¬', 'ç²¾æ˜'],
                    'æ¯”è‚©': ['å…„å¼Ÿ', 'æœ‹å‹', 'åŒäº‹', 'ç«äº‰', 'è‡ªä¿¡', 'è‡ªå°Š'],
                    'åŠ«è´¢': ['å§å¦¹', 'äº‰å¤º', 'æ¬ºéª—', 'æŠ•æœº', 'æ‰‹è„š', 'ä¹‰æ°”'],
                    'é£Ÿç¥': ['å¥³å„¿', 'å¿«ä¹', 'è‰ºæœ¯', 'å£ç¦', 'æ…¢æ€§ç—…', 'æ¸©å’Œ'],
                    'ä¼¤å®˜': ['æ™ºæ…§', 'æ‰è‰º', 'å›é€†', 'å£èˆŒ', 'å­å¥³', 'æ€¥æ€§ç—…']
                };
                return shiShenMap[shiShen] || [];
            },

            getTianGanXiang: function(tianGan) {
                const tianGanMap = {
                    'ç”²': ['æ ‹æ¢', 'æ ‘æœ¨', 'é¢†å¯¼', 'å¼€å§‹', 'å¤´éƒ¨', 'èƒ†', 'æ­£ç›´'],
                    'ä¹™': ['èŠ±è‰', 'è—¤è”“', 'æŸ”éŸ§', 'è‰ºæœ¯', 'é¢ˆéƒ¨', 'è‚', 'æ¸©å’Œ'],
                    'ä¸™': ['å¤ªé˜³', 'å…‰æ˜', 'çƒ­æƒ…', 'æƒåŠ›', 'çœ¼ç›', 'å¿ƒè„', 'æ€¥èº'],
                    'ä¸': ['çƒ›å…‰', 'æ–‡æ˜', 'ç¤¼è²Œ', 'ç¥ç§˜', 'å¿ƒè„', 'è¡€æ¶²', 'æ¸©æš–'],
                    'æˆŠ': ['é«˜å±±', 'åœŸåœ°', 'è¯šä¿¡', 'ç¨³é‡', 'èƒƒ', 'è„¾', 'å¿ åš'],
                    'å·±': ['ç”°å›­', 'åœŸå£¤', 'åŒ…å®¹', 'å«è“„', 'è„¾', 'èƒ°è…º', 'ç»†è‡´'],
                    'åºš': ['æ–§å¤´', 'é‡‘å±', 'åˆšå¼º', 'å˜é©', 'å¤§è‚ ', 'è‚º', 'ä¹‰æ°”'],
                    'è¾›': ['ç å®', 'é¦–é¥°', 'ç²¾è‡´', 'ç¾å®¹', 'è‚º', 'å‘¼å¸é“', 'ç»†è…»'],
                    'å£¬': ['æ±Ÿæ²³', 'æ™ºæ…§', 'å˜é€š', 'æµåŠ¨', 'è†€èƒ±', 'è‚¾', 'èªæ˜'],
                    'ç™¸': ['é›¨éœ²', 'æ»‹æ¶¦', 'åŒ…å®¹', 'è€å¿ƒ', 'è‚¾', 'æ³Œå°¿', 'æ¸©æŸ”']
                };
                return tianGanMap[tianGan] || [];
            },

            getDiZhiXiang: function(diZhi) {
                const diZhiMap = {
                    'å­': ['æ°´', 'èªæ˜', 'ç›—è´¼', 'å¦‡å¥³', 'è‚¾', 'è€³', 'è¯¡ç§˜'],
                    'ä¸‘': ['åœŸ', 'å¯’å†°', 'ä»“åº“', 'ç”°å›­', 'è„¾', 'èƒƒ', 'ç¨³å®š'],
                    'å¯…': ['æœ¨', 'è€è™', 'å®˜å‘˜', 'èƒ†', 'å››è‚¢', 'ä»ä¹‰'],
                    'å¯': ['æœ¨', 'å…”å­', 'é—¨çª—', 'è‚', 'æŒ‡', 'æ¸©å’Œ'],
                    'è¾°': ['åœŸ', 'é¾™', 'æ°´åº“', 'èƒƒ', 'è‚©', 'å˜åŒ–'],
                    'å·³': ['ç«', 'è›‡', 'æ–‡ä¹¦', 'å¿ƒ', 'å–‰', 'æ–‡æ˜'],
                    'åˆ': ['ç«', 'é©¬', 'æ–‡æ˜', 'å¿ƒè„', 'èˆŒ', 'çƒ­æƒ…'],
                    'æœª': ['åœŸ', 'ç¾Š', 'ç”°å›­', 'è„¾', 'è…¹', 'æ¸©å’Œ'],
                    'ç”³': ['é‡‘', 'çŒ´å­', 'æ³•å¾‹', 'å¤§è‚ ', 'éª¨', 'ä¹‰æ°”'],
                    'é…‰': ['é‡‘', 'é¸¡', 'é¦–é¥°', 'è‚º', 'è‚‹', 'ç²¾è‡´'],
                    'æˆŒ': ['åœŸ', 'ç‹—', 'å¯ºåº™', 'èƒƒ', 'è…¿', 'å¿ è¯š'],
                    'äº¥': ['æ°´', 'çŒª', 'æ¹–æ³Š', 'è‚¾', 'å¤´', 'æ™ºæ…§']
                };
                return diZhiMap[diZhi] || [];
            },

            generateComprehensiveImages: function(xiangAnalysis) {
                const images = [];

                // ä»åç¥å–è±¡ç”Ÿæˆæ„è±¡
                Object.values(xiangAnalysis.åç¥å–è±¡).forEach(shiShenXiang => {
                    if (Array.isArray(shiShenXiang)) {
                        images.push(...shiShenXiang);
                    }
                });

                // ä»å¹²æ”¯å–è±¡ç”Ÿæˆæ„è±¡
                Object.values(xiangAnalysis.å¹²æ”¯å–è±¡).forEach(ganZhiXiang => {
                    if (ganZhiXiang.å¤©å¹²) images.push(...ganZhiXiang.å¤©å¹²);
                    if (ganZhiXiang.åœ°æ”¯) images.push(...ganZhiXiang.åœ°æ”¯);
                });

                return [...new Set(images)]; // å»é‡
            },

            analyzeQiXing: function(bazi, gender) {
                if (gender === 'ç”·') {
                    return {
                        å¦»æ˜Ÿ: "æ­£è´¢å­˜åœ¨",
                        å¦»å®«: bazi.day.åœ°æ”¯,
                        å©šå§»çŠ¶å†µ: "éœ€è¦ç»¼åˆåˆ†æ"
                    };
                } else {
                    return {
                        å¤«æ˜Ÿ: "æ­£å®˜å­˜åœ¨",
                        å¤«å®«: bazi.day.åœ°æ”¯,
                        å©šå§»çŠ¶å†µ: "éœ€è¦ç»¼åˆåˆ†æ"
                    };
                }
            },

            analyzeCaiXing: function(bazi) {
                return {
                    æ­£è´¢: "æ­£è´¢å­˜åœ¨",
                    åè´¢: "åè´¢å­˜åœ¨",
                    è´¢è¿: "ä¸­ç­‰åä¸Š"
                };
            },

            analyzeZiNv: function(bazi, gender) {
                if (gender === 'ç”·') {
                    return {
                        å­æ˜Ÿ: "ä¸ƒæ€å­˜åœ¨",
                        å­å¥³: "ä¸€èˆ¬"
                    };
                } else {
                    return {
                        å­æ˜Ÿ: "é£Ÿç¥å­˜åœ¨",
                        å­å¥³: "ä¸€èˆ¬"
                    };
                }
            }
        };

        // ç®€åŒ–ç‰ˆåº”ç”¨ç±»
        class SimpleBaziApp {
            constructor() {
                this.currentAnalysis = null;
                this.analysisHistory = [];
                this.isAnalyzing = false;
                this.bindEvents();
                this.loadSavedData();
            }

            bindEvents() {
                // è¡¨å•æäº¤
                const form = document.getElementById('bazi-form');
                if (form) {
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.startAnalysis();
                    });
                }

                // æ¼”ç¤ºæŒ‰é’®
                const demoBtn = document.getElementById('demo-btn');
                if (demoBtn) {
                    demoBtn.addEventListener('click', () => {
                        this.loadDemoData();
                    });
                }

                // æ¸…ç©ºæŒ‰é’®
                const clearBtn = document.getElementById('clear-btn');
                if (clearBtn) {
                    clearBtn.addEventListener('click', () => {
                        this.clearForm();
                    });
                }

                // ç»“æœæ“ä½œæŒ‰é’®
                this.bindResultActions();

                // å†å²è®°å½•æŒ‰é’®
                this.bindHistoryActions();

                // å¸®åŠ©æ ‡ç­¾é¡µ
                this.bindHelpTabs();
            }

            async startAnalysis() {
                if (this.isAnalyzing) {
                    this.showMessage('æ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...', 'warning');
                    return;
                }

                const formData = this.collectFormData();
                if (!formData) {
                    this.showMessage('è¯·å¡«å†™å®Œæ•´çš„åŸºæœ¬ä¿¡æ¯', 'error');
                    return;
                }

                this.isAnalyzing = true;
                this.showAnalysisProgress();

                try {
                    // æ¨¡æ‹Ÿåˆ†ææ­¥éª¤
                    await this.updateStep('step-paipan', 'æ­£åœ¨è¿›è¡Œå…«å­—æ’ç›˜...');
                    await this.delay(500);

                    await this.updateStep('step-xiangfa', 'è¿›è¡Œæ¢ç´¢é—¨å–è±¡åˆ†æ...');
                    await this.delay(800);

                    await this.updateStep('step-jinglun', 'è¿›è¡Œå‘½ç†ç²¾è®ºåˆ†æ...');
                    await this.delay(800);

                    await this.updateStep('step-qicai', 'è¿›è¡Œå¦»è´¢ä¸“é¡¹åˆ†æ...');
                    await this.delay(800);

                    if (formData.liuNian) {
                        await this.updateStep('step-liunian', 'è¿›è¡Œæµå¹´å®åŠ¡åˆ†æ...');
                        await this.delay(800);
                    }

                    await this.updateStep('step-anli', 'è¿›è¡Œæ¡ˆä¾‹éªŒè¯...');
                    await this.delay(800);

                    await this.updateStep('step-zonghe', 'ç”Ÿæˆç»¼åˆå»ºè®®...');
                    await this.delay(500);

                    // ç”Ÿæˆæ¨¡æ‹Ÿå…«å­—
                    const bazi = this.generateMockBazi(formData);

                    // è¿›è¡Œåˆ†æ
                    const analysis = stage04System.comprehensiveAnalysis(bazi, formData);
                    this.currentAnalysis = {
                        ...analysis,
                        timestamp: new Date().toISOString(),
                        formData: formData
                    };

                    this.hideAnalysisProgress();
                    this.displayResults(analysis);
                    this.addToHistory(this.currentAnalysis);

                    this.showMessage('å®æˆ˜æŠ€æ³•åˆ†æå®Œæˆï¼', 'success');

                } catch (error) {
                    console.error('åˆ†æè¿‡ç¨‹å‡ºé”™:', error);
                    this.showMessage('åˆ†æè¿‡ç¨‹å‡ºé”™ï¼Œè¯·é‡è¯•', 'error');
                    this.hideAnalysisProgress();
                } finally {
                    this.isAnalyzing = false;
                }
            }

            collectFormData() {
                const name = document.getElementById('name')?.value?.trim();
                const gender = document.getElementById('gender')?.value;
                const birthDate = document.getElementById('birth-date')?.value;
                const birthTime = document.getElementById('birth-time')?.value;
                const liuNian = document.getElementById('liu-nian')?.value?.trim();
                const focus = document.getElementById('focus')?.value;

                if (!name || !gender || !birthDate || !birthTime) {
                    return null;
                }

                return {
                    name,
                    gender,
                    birthDateTime: `${birthDate} ${birthTime}`,
                    liuNian: liuNian || undefined,
                    focus,
                    methods: this.getSelectedMethods()
                };
            }

            getSelectedMethods() {
                const checkboxes = document.querySelectorAll('input[name="methods"]:checked');
                return Array.from(checkboxes).map(cb => cb.value);
            }

            generateMockBazi(formData) {
                // ç®€åŒ–çš„å…«å­—ç”Ÿæˆé€»è¾‘
                const tianGan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
                const diZhi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
                const shiShen = ['æ­£å®˜', 'ä¸ƒæ€', 'æ­£è´¢', 'åè´¢', 'æ­£å°', 'åå°', 'æ¯”è‚©', 'åŠ«è´¢', 'é£Ÿç¥', 'ä¼¤å®˜'];

                const getRandomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];

                return {
                    year: { å¤©å¹²: getRandomElement(tianGan), åœ°æ”¯: getRandomElement(diZhi), åç¥: getRandomElement(shiShen) },
                    month: { å¤©å¹²: getRandomElement(tianGan), åœ°æ”¯: getRandomElement(diZhi), åç¥: getRandomElement(shiShen) },
                    day: { å¤©å¹²: getRandomElement(tianGan), åœ°æ”¯: getRandomElement(diZhi), åç¥: 'æ—¥ä¸»' },
                    hour: { å¤©å¹²: getRandomElement(tianGan), åœ°æ”¯: getRandomElement(diZhi), åç¥: getRandomElement(shiShen) }
                };
            }

            showAnalysisProgress() {
                const progressSection = document.getElementById('analysis-progress');
                if (progressSection) {
                    progressSection.style.display = 'block';
                }
                this.resetAllSteps();
                this.updateProgress(0);
            }

            hideAnalysisProgress() {
                const progressSection = document.getElementById('analysis-progress');
                if (progressSection) {
                    progressSection.style.display = 'none';
                }
            }

            async updateStep(stepId, text) {
                const step = document.getElementById(stepId);
                const statusElement = step?.querySelector('.step-status');
                const progressText = document.getElementById('progress-text');

                if (statusElement) {
                    statusElement.textContent = 'processing';
                    statusElement.className = 'step-status processing';
                }

                if (progressText) {
                    progressText.textContent = text;
                }

                // æ›´æ–°è¿›åº¦æ¡
                const steps = ['step-paipan', 'step-xiangfa', 'step-jinglun', 'step-qicai', 'step-liunian', 'step-anli', 'step-zonghe'];
                const currentIndex = steps.indexOf(stepId);
                if (currentIndex !== -1) {
                    this.updateProgress((currentIndex + 1) / steps.length * 100);
                }

                await this.delay(300);

                if (statusElement) {
                    statusElement.textContent = 'completed';
                    statusElement.className = 'step-status completed';
                }
            }

            resetAllSteps() {
                const steps = document.querySelectorAll('.step');
                steps.forEach(step => {
                    const status = step.querySelector('.step-status');
                    if (status) {
                        status.textContent = 'pending';
                        status.className = 'step-status pending';
                    }
                });
            }

            updateProgress(percentage) {
                const progressFill = document.getElementById('progress-fill');
                if (progressFill) {
                    progressFill.style.width = `${percentage}%`;
                }
            }

            displayResults(analysis) {
                const resultsContainer = document.getElementById('results-container');
                const resultsActions = document.getElementById('results-actions');

                if (!resultsContainer) return;

                resultsContainer.innerHTML = this.generateResultsHTML(analysis);
                resultsActions.style.display = 'block';

                // ç»‘å®šç»“æœé¡µé¢çš„äº¤äº’äº‹ä»¶
                this.bindResultsInteractions();
            }

            generateResultsHTML(analysis) {
                return `
                    <div class="analysis-results">
                        <!-- åŸºæœ¬ä¿¡æ¯ -->
                        <div class="result-section">
                            <h3 class="result-title">ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h3>
                            <div class="result-content">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="label">å§“åï¼š</span>
                                        <span class="value">${analysis.åŸºæœ¬ä¿¡æ¯.å§“å}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">æ€§åˆ«ï¼š</span>
                                        <span class="value">${analysis.åŸºæœ¬ä¿¡æ¯.æ€§åˆ«}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">å‡ºç”Ÿæ—¥æœŸï¼š</span>
                                        <span class="value">${analysis.åŸºæœ¬ä¿¡æ¯.å‡ºç”Ÿæ—¥æœŸ}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">å…«å­—ï¼š</span>
                                        <span class="value bazi-display">
                                            ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.å¹´æŸ±}
                                            ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æœˆæŸ±}
                                            ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æ—¥æŸ±}
                                            ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æ—¶æŸ±}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å–è±¡åˆ†æ -->
                        <div class="result-section">
                            <h3 class="result-title">ğŸ¨ æ¢ç´¢é—¨å–è±¡åˆ†æ</h3>
                            <div class="result-content">
                                <div class="xiang-analysis">
                                    <div class="xiang-category">
                                        <h4>åç¥å–è±¡</h4>
                                        <div class="xiang-items">
                                            ${Object.entries(analysis.å–è±¡åˆ†æ.åç¥å–è±¡).map(([pillar, xiang]) => `
                                                <div class="xiang-item">
                                                    <span class="pillar-name">${this.getPillarName(pillar)}ï¼š</span>
                                                    <span class="xiang-content">${Array.isArray(xiang) ? xiang.join('ã€') : xiang}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <div class="xiang-category">
                                        <h4>ç»¼åˆæ„è±¡</h4>
                                        <div class="xiang-images">
                                            ${analysis.å–è±¡åˆ†æ.ç»¼åˆæ„è±¡.map(image => `
                                                <span class="image-tag">${image}</span>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å‘½ç†ç²¾è®ºåˆ†æ -->
                        <div class="result-section">
                            <h3 class="result-title">ğŸ“š å‘½ç†ç²¾è®ºåˆ†æ</h3>
                            <div class="result-content">
                                <div class="jinglun-analysis">
                                    <div class="analysis-item">
                                        <h4>å“²å­¦æ€æƒ³</h4>
                                        <div class="philosophy-items">
                                            ${Object.entries(analysis.ç²¾è®ºåˆ†æ.å“²å­¦æ€æƒ³).map(([key, value]) => `
                                                <div class="philosophy-item">
                                                    <span class="concept">${key}ï¼š</span>
                                                    <span class="explanation">${value}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <div class="analysis-item">
                                        <h4>ç—…è¯åˆ†æ</h4>
                                        <div class="bingyao-result">
                                            <div class="bing">
                                                <strong>å‘½å±€ä¹‹ç—…ï¼š</strong>
                                                ${analysis.ç²¾è®ºåˆ†æ.ç—…è¯åˆ†æ.å‘½å±€ä¹‹ç—….join('ã€') || 'æ— æ˜æ˜¾ç—…ç—‡'}
                                            </div>
                                            <div class="yao">
                                                <strong>å¯¹ç—‡ä¹‹è¯ï¼š</strong>
                                                ${analysis.ç²¾è®ºåˆ†æ.ç—…è¯åˆ†æ.å¯¹ç—‡ä¹‹è¯.join('ã€') || 'æ— éœ€ç”¨è¯'}
                                            </div>
                                            <div class="plan">
                                                <strong>æ²»ç–—æ–¹æ¡ˆï¼š</strong>
                                                ${analysis.ç²¾è®ºåˆ†æ.ç—…è¯åˆ†æ.æ²»ç–—æ–¹æ¡ˆ.join('ã€') || 'ä¿æŒç°çŠ¶'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- å¦»è´¢åˆ†æ -->
                        <div class="result-section">
                            <h3 class="result-title">ğŸ’° å¦»è´¢ä¸“é¡¹åˆ†æ</h3>
                            <div class="result-content">
                                <div class="qicai-analysis">
                                    <div class="qicai-item">
                                        <h4>å¦»æ˜Ÿ/å¤«æ˜Ÿåˆ†æ</h4>
                                        <div class="qixing-result">
                                            ${Object.entries(analysis.å¦»è´¢åˆ†æ.å¦»æ˜Ÿåˆ†æ).map(([key, value]) => `
                                                <div class="qixing-detail">
                                                    <span class="detail-label">${key}ï¼š</span>
                                                    <span class="detail-value">${value}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>

                                    <div class="qicai-item">
                                        <h4>è´¢æ˜Ÿåˆ†æ</h4>
                                        <div class="caixing-result">
                                            ${Object.entries(analysis.å¦»è´¢åˆ†æ.è´¢æ˜Ÿåˆ†æ).map(([key, value]) => `
                                                <div class="caixing-detail">
                                                    <span class="detail-label">${key}ï¼š</span>
                                                    <span class="detail-value">${value}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- æµå¹´åˆ†æï¼ˆå¦‚æœæœ‰ï¼‰ -->
                        ${Object.keys(analysis.æµå¹´åˆ†æ).length > 0 ? `
                            <div class="result-section">
                                <h3 class="result-title">ğŸ“… æµå¹´å®åŠ¡åˆ†æ</h3>
                                <div class="result-content">
                                    <div class="liunian-analysis">
                                        ${Object.entries(analysis.æµå¹´åˆ†æ).map(([key, value]) => `
                                            <div class="liunian-item">
                                                <h4>${this.getLiunianItemName(key)}</h4>
                                                <div class="liunian-content">
                                                    ${typeof value === 'object' ? JSON.stringify(value, null, 2) : value}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        <!-- æ¡ˆä¾‹éªŒè¯ -->
                        <div class="result-section">
                            <h3 class="result-title">ğŸ” æ¡ˆä¾‹éªŒè¯</h3>
                            <div class="result-content">
                                <div class="case-validation">
                                    <div class="validation-metrics">
                                        <div class="metric">
                                            <span class="metric-label">ç›¸ä¼¼æ¡ˆä¾‹ï¼š</span>
                                            <span class="metric-value">${analysis.æ¡ˆä¾‹éªŒè¯.ç›¸ä¼¼æ¡ˆä¾‹.length} ä¸ª</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">ç¬¦åˆåº¦ï¼š</span>
                                            <span class="metric-value">${analysis.æ¡ˆä¾‹éªŒè¯.ç¬¦åˆåº¦}</span>
                                        </div>
                                    </div>
                                    <div class="validation-advice">
                                        <strong>éªŒè¯å»ºè®®ï¼š</strong>${analysis.æ¡ˆä¾‹éªŒè¯.éªŒè¯å»ºè®®}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ç»¼åˆå»ºè®® -->
                        <div class="result-section">
                            <h3 class="result-title">ğŸ¯ ç»¼åˆå»ºè®®</h3>
                            <div class="result-content">
                                <div class="comprehensive-advice">
                                    ${Object.entries(analysis.ç»¼åˆå»ºè®®).map(([key, value]) => `
                                        <div class="advice-item">
                                            <h4 class="advice-title">${this.getAdviceIcon(key)} ${this.getAdviceName(key)}</h4>
                                            <p class="advice-content">${value}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            getPillarName(pillar) {
                const names = {
                    year: 'å¹´æŸ±',
                    month: 'æœˆæŸ±',
                    day: 'æ—¥æŸ±',
                    hour: 'æ—¶æŸ±'
                };
                return names[pillar] || pillar;
            }

            getLiunianItemName(key) {
                const names = {
                    æµå¹´æ€»è¯„: 'æµå¹´æ€»ä½“è¯„ä»·',
                    æµå¹´å–è±¡: 'æµå¹´å–è±¡åˆ†æ',
                    åº”æœŸåˆ¤æ–­: 'åº”æœŸåˆ¤æ–­ç»“æœ',
                    è¶‹é¿å»ºè®®: 'è¶‹é¿å»ºè®®æŒ‡å¯¼'
                };
                return names[key] || key;
            }

            getAdviceIcon(key) {
                const icons = {
                    äººç”Ÿè§„åˆ’: 'ğŸ—ºï¸',
                    äº‹ä¸šå‘å±•: 'ğŸ’¼',
                    å©šå§»æ„Ÿæƒ…: 'ğŸ’•',
                    è´¢å¯Œç®¡ç†: 'ğŸ’°',
                    å¥åº·å…»ç”Ÿ: 'ğŸƒ',
                    å¼€è¿å»ºè®®: 'âœ¨'
                };
                return icons[key] || 'ğŸ“‹';
            }

            getAdviceName(key) {
                return key;
            }

            bindResultActions() {
                const exportBtn = document.getElementById('export-btn');
                const printBtn = document.getElementById('print-btn');
                const shareBtn = document.getElementById('share-btn');

                if (exportBtn) {
                    exportBtn.addEventListener('click', () => {
                        this.exportResults();
                    });
                }

                if (printBtn) {
                    printBtn.addEventListener('click', () => {
                        this.printResults();
                    });
                }

                if (shareBtn) {
                    shareBtn.addEventListener('click', () => {
                        this.shareResults();
                    });
                }
            }

            exportResults() {
                if (!this.currentAnalysis) {
                    this.showMessage('æ²¡æœ‰å¯å¯¼å‡ºçš„åˆ†æç»“æœ', 'warning');
                    return;
                }

                const content = this.generateReportContent();
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = `å…«å­—å®æˆ˜æŠ€æ³•åˆ†ææŠ¥å‘Š_${this.currentAnalysis.åŸºæœ¬ä¿¡æ¯.å§“å}_${new Date().toLocaleDateString()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                this.showMessage('åˆ†ææŠ¥å‘Šå·²å¯¼å‡º', 'success');
            }

            generateReportContent() {
                const analysis = this.currentAnalysis;
                return `
=======================================
ç¬¬å››é˜¶æ®µå®æˆ˜æŠ€æ³•å…«å­—åˆ†ææŠ¥å‘Š
=======================================

åŸºæœ¬ä¿¡æ¯ï¼š
å§“åï¼š${analysis.åŸºæœ¬ä¿¡æ¯.å§“å}
æ€§åˆ«ï¼š${analysis.åŸºæœ¬ä¿¡æ¯.æ€§åˆ«}
å‡ºç”Ÿæ—¥æœŸï¼š${analysis.åŸºæœ¬ä¿¡æ¯.å‡ºç”Ÿæ—¥æœŸ}
å…«å­—ï¼š${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.å¹´æŸ±} ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æœˆæŸ±} ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æ—¥æŸ±} ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æ—¶æŸ±}

=======================================
æ¢ç´¢é—¨å–è±¡åˆ†æ
=======================================
ç»¼åˆæ„è±¡ï¼š${analysis.å–è±¡åˆ†æ.ç»¼åˆæ„è±¡.join('ã€')}

=======================================
å‘½ç†ç²¾è®ºåˆ†æ
=======================================
å“²å­¦æ€æƒ³ï¼š
${Object.entries(analysis.ç²¾è®ºåˆ†æ.å“²å­¦æ€æƒ³).map(([key, value]) => `${key}ï¼š${value}`).join('\n')}

ç—…è¯åˆ†æï¼š
å‘½å±€ä¹‹ç—…ï¼š${analysis.ç²¾è®ºåˆ†æ.ç—…è¯åˆ†æ.å‘½å±€ä¹‹ç—….join('ã€')}
å¯¹ç—‡ä¹‹è¯ï¼š${analysis.ç²¾è®ºåˆ†æ.ç—…è¯åˆ†æ.å¯¹ç—‡ä¹‹è¯.join('ã€')}
æ²»ç–—æ–¹æ¡ˆï¼š${analysis.ç²¾è®ºåˆ†æ.ç—…è¯åˆ†æ.æ²»ç–—æ–¹æ¡ˆ.join('ã€')}

=======================================
å¦»è´¢ä¸“é¡¹åˆ†æ
=======================================
${Object.entries(analysis.å¦»è´¢åˆ†æ.å¦»æ˜Ÿåˆ†æ).map(([key, value]) => `${key}ï¼š${value}`).join('\n')}
${Object.entries(analysis.å¦»è´¢åˆ†æ.è´¢æ˜Ÿåˆ†æ).map(([key, value]) => `${key}ï¼š${value}`).join('\n')}

=======================================
ç»¼åˆå»ºè®®
=======================================
${Object.entries(analysis.ç»¼åˆå»ºè®®).map(([key, value]) => `${key}ï¼š${value}`).join('\n')}

=======================================
åˆ†ææ—¶é—´ï¼š${new Date().toLocaleString()}
=======================================
                `;
            }

            printResults() {
                if (!this.currentAnalysis) {
                    this.showMessage('æ²¡æœ‰å¯æ‰“å°çš„åˆ†æç»“æœ', 'warning');
                    return;
                }

                window.print();
                this.showMessage('æ‰“å°çª—å£å·²æ‰“å¼€', 'success');
            }

            shareResults() {
                if (!this.currentAnalysis) {
                    this.showMessage('æ²¡æœ‰å¯åˆ†äº«çš„åˆ†æç»“æœ', 'warning');
                    return;
                }

                const shareText = `ç¬¬å››é˜¶æ®µå®æˆ˜æŠ€æ³•å…«å­—åˆ†æç»“æœï¼š\nå§“åï¼š${this.currentAnalysis.åŸºæœ¬ä¿¡æ¯.å§“å}\nç»¼åˆå»ºè®®ï¼š${this.currentAnalysis.ç»¼åˆå»ºè®®.äººç”Ÿè§„åˆ’}`;

                if (navigator.share) {
                    navigator.share({
                        title: 'å…«å­—å®æˆ˜æŠ€æ³•åˆ†æç»“æœ',
                        text: shareText
                    }).catch(err => {
                        console.log('åˆ†äº«å¤±è´¥:', err);
                        this.copyToClipboard(shareText);
                    });
                } else {
                    this.copyToClipboard(shareText);
                }
            }

            copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    this.showMessage('åˆ†æç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(() => {
                    this.showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 'error');
                });
            }

            addToHistory(analysis) {
                this.analysisHistory.unshift(analysis);

                // é™åˆ¶å†å²è®°å½•æ•°é‡
                if (this.analysisHistory.length > 20) {
                    this.analysisHistory = this.analysisHistory.slice(0, 20);
                }

                this.saveToLocalStorage();
                this.updateHistoryDisplay();
            }

            updateHistoryDisplay() {
                const historyList = document.getElementById('history-list');
                if (!historyList) return;

                if (this.analysisHistory.length === 0) {
                    historyList.innerHTML = '<div class="placeholder"><p>æš‚æ— åˆ†æå†å²</p></div>';
                    return;
                }

                historyList.innerHTML = this.analysisHistory.map((analysis, index) => `
                    <div class="history-item" data-index="${index}">
                        <div class="history-header">
                            <span class="history-name">${analysis.åŸºæœ¬ä¿¡æ¯.å§“å}</span>
                            <span class="history-date">${new Date(analysis.timestamp).toLocaleString()}</span>
                        </div>
                        <div class="history-bazi">${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.å¹´æŸ±} ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æœˆæŸ±} ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æ—¥æŸ±} ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æ—¶æŸ±}</div>
                        <div class="history-actions">
                            <button class="view-btn" onclick="app.viewHistory(${index})">æŸ¥çœ‹</button>
                            <button class="delete-btn" onclick="app.deleteHistory(${index})">åˆ é™¤</button>
                        </div>
                    </div>
                `).join('');
            }

            viewHistory(index) {
                const analysis = this.analysisHistory[index];
                if (analysis) {
                    this.currentAnalysis = analysis;
                    this.displayResults(analysis);

                    // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                    const resultsSection = document.querySelector('.results-section');
                    if (resultsSection) {
                        resultsSection.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            }

            deleteHistory(index) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²è®°å½•å—ï¼Ÿ')) {
                    this.analysisHistory.splice(index, 1);
                    this.saveToLocalStorage();
                    this.updateHistoryDisplay();
                    this.showMessage('å†å²è®°å½•å·²åˆ é™¤', 'success');
                }
            }

            bindHistoryActions() {
                const clearHistoryBtn = document.getElementById('clear-history-btn');
                const exportHistoryBtn = document.getElementById('export-history-btn');

                if (clearHistoryBtn) {
                    clearHistoryBtn.addEventListener('click', () => {
                        if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                            this.analysisHistory = [];
                            this.saveToLocalStorage();
                            this.updateHistoryDisplay();
                            this.showMessage('å†å²è®°å½•å·²æ¸…ç©º', 'success');
                        }
                    });
                }

                if (exportHistoryBtn) {
                    exportHistoryBtn.addEventListener('click', () => {
                        this.exportHistory();
                    });
                }
            }

            exportHistory() {
                if (this.analysisHistory.length === 0) {
                    this.showMessage('æ²¡æœ‰å¯å¯¼å‡ºçš„å†å²è®°å½•', 'warning');
                    return;
                }

                const content = this.analysisHistory.map((analysis, index) => {
                    return `
=======================================
å†å²è®°å½• ${index + 1}
=======================================
å§“åï¼š${analysis.åŸºæœ¬ä¿¡æ¯.å§“å}
æ€§åˆ«ï¼š${analysis.åŸºæœ¬ä¿¡æ¯.æ€§åˆ«}
å‡ºç”Ÿæ—¥æœŸï¼š${analysis.åŸºæœ¬ä¿¡æ¯.å‡ºç”Ÿæ—¥æœŸ}
å…«å­—ï¼š${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.å¹´æŸ±} ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æœˆæŸ±} ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æ—¥æŸ±} ${analysis.åŸºæœ¬ä¿¡æ¯.å…«å­—.æ—¶æŸ±}
åˆ†ææ—¶é—´ï¼š${new Date(analysis.timestamp).toLocaleString()}
ç»¼åˆå»ºè®®ï¼š${analysis.ç»¼åˆå»ºè®®.äººç”Ÿè§„åˆ’}
                    `;
                }).join('\n');

                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = `å…«å­—å®æˆ˜æŠ€æ³•åˆ†æå†å²_${new Date().toLocaleDateString()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                this.showMessage('å†å²è®°å½•å·²å¯¼å‡º', 'success');
            }

            bindHelpTabs() {
                const tabButtons = document.querySelectorAll('.tab-btn');
                const panels = document.querySelectorAll('.help-panel');

                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const targetPanel = button.dataset.tab;

                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');

                        // æ›´æ–°é¢æ¿æ˜¾ç¤º
                        panels.forEach(panel => panel.classList.remove('active'));
                        const targetPanelElement = document.getElementById(`panel-${targetPanel}`);
                        if (targetPanelElement) {
                            targetPanelElement.classList.add('active');
                        }
                    });
                });
            }

            loadDemoData() {
                const demoData = {
                    name: 'å¼ ä¸‰',
                    gender: 'ç”·',
                    birthDate: '1990-05-15',
                    birthTime: '14:30',
                    liuNian: 'ç”²è¾° 2024',
                    focus: 'ç»¼åˆ'
                };

                // å¡«å……è¡¨å•
                document.getElementById('name').value = demoData.name;
                document.getElementById('gender').value = demoData.gender;
                document.getElementById('birth-date').value = demoData.birthDate;
                document.getElementById('birth-time').value = demoData.birthTime;
                document.getElementById('liu-nian').value = demoData.liuNian;
                document.getElementById('focus').value = demoData.focus;

                this.showMessage('å·²åŠ è½½æ¼”ç¤ºæ¡ˆä¾‹æ•°æ®', 'success');
            }

            clearForm() {
                const form = document.getElementById('bazi-form');
                if (form) {
                    form.reset();
                }

                // æ¸…ç©ºç»“æœ
                const resultsContainer = document.getElementById('results-container');
                if (resultsContainer) {
                    resultsContainer.innerHTML = `
                        <div class="placeholder">
                            <div class="placeholder-icon">ğŸ“</div>
                            <p>è¯·è¾“å…¥åŸºæœ¬ä¿¡æ¯å¹¶ç‚¹å‡»"å¼€å§‹å®æˆ˜æŠ€æ³•åˆ†æ"æŒ‰é’®</p>
                        </div>
                    `;
                }

                // éšè—ç»“æœæ“ä½œæŒ‰é’®
                const resultsActions = document.getElementById('results-actions');
                if (resultsActions) {
                    resultsActions.style.display = 'none';
                }

                this.showMessage('è¡¨å•å·²æ¸…ç©º', 'success');
            }

            showMessage(message, type = 'info') {
                const messageEl = document.createElement('div');
                messageEl.className = `message message-${type}`;
                messageEl.textContent = message;

                document.body.appendChild(messageEl);

                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.parentNode.removeChild(messageEl);
                    }
                }, 3000);
            }

            bindResultsInteractions() {
                // æ·»åŠ å±•å¼€/æŠ˜å åŠŸèƒ½
                const resultTitles = document.querySelectorAll('.result-title');
                resultTitles.forEach(title => {
                    title.addEventListener('click', () => {
                        const section = title.parentElement;
                        section.classList.toggle('collapsed');
                    });
                });
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            saveToLocalStorage() {
                try {
                    localStorage.setItem('bazi-stage4-analysis-history', JSON.stringify(this.analysisHistory));
                } catch (error) {
                    console.error('ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨å¤±è´¥:', error);
                }
            }

            loadSavedData() {
                try {
                    const saved = localStorage.getItem('bazi-stage4-analysis-history');
                    if (saved) {
                        this.analysisHistory = JSON.parse(saved);
                        this.updateHistoryDisplay();
                    }
                } catch (error) {
                    console.error('åŠ è½½æœ¬åœ°å­˜å‚¨æ•°æ®å¤±è´¥:', error);
                    this.analysisHistory = [];
                }
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new SimpleBaziApp();
            console.log('ç¬¬å››é˜¶æ®µå®æˆ˜æŠ€æ³•å…«å­—åº”ç”¨åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html>